<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=preconnect  href="https://fonts.googleapis.com"> <link rel=preconnect  href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel=stylesheet > <link rel=stylesheet  href="/starcoffee/libs/katex/katex.min.css"> <link rel=stylesheet  href="/starcoffee/libs/highlight/styles/github.min.css"> <link rel=stylesheet  href="/starcoffee/css/franklin.css"> <link rel=stylesheet  href="/starcoffee/css/poole_lanyon.css"> <link rel=stylesheet  href="/starcoffee/css/adjust.css"> <link rel=icon  href="/starcoffee/assets/favicon.png"> <title>Direct Shooting Method with Approximated Jacobian Matrices</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>Star Coffee</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/starcoffee/">Home</a> <a class="sidebar-nav-item " href="/starcoffee/posts/welcome-to-star-coffee/">Welcome to Star Coffee</a> <a class="sidebar-nav-item " href="/starcoffee/posts/projects/">Projects</a> <a class="sidebar-nav-item " href="/starcoffee/posts/satellite-analysis-toolkit/">Satellite Analysis Toolkit</a> <a class="sidebar-nav-item " href="/starcoffee/posts/simple-nn/">Simple NN</a> </nav> <div class=sidebar-item > <p>&copy; Michal Jagodzinski.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/starcoffee/" title=Home >Star Coffee</a> <small>Writing about stuff, working in public</small> </h3> </div> </div> <div class="container content"> <div class=franklin-content ><h1 id=direct_shooting_method_with_approximated_jacobian_matrices ><a href="#direct_shooting_method_with_approximated_jacobian_matrices" class=header-anchor >Direct Shooting Method with Approximated Jacobian Matrices</a></h1> <p><em>By Michal Jagodzinski - May 6th, 2023</em></p> <div class=franklin-toc ><ol><li><a href="#previous_example_target_hitting_with_automatic_differentiation">Previous Example: Target Hitting with Automatic Differentiation</a><li><a href="#approximating_the_jacobian_matrix_with_finite_differences">Approximating the Jacobian Matrix with Finite Differences</a><li><a href="#hitting_a_target_in_mid-air">Hitting a Target in Mid-Air</a><li><a href="#conclusion">Conclusion</a></ol></div> <div class=im-100 ><img src="https://source.unsplash.com/yvwd-CofSqA" alt="" /></div> <div class=img-caption >Photo by <a href="https://unsplash.com/photos/yvwd-CofSqA">Kym MacKinnon</a></div> <p>Alright, I know the title of this post is quite a mouthful, but it&#39;s the best I can do. We&#39;re building upon my previous optimal control post, <a href="https://michaszj.github.io/starcoffee/posts/the-direct-shooting-method/">The Direct Shooting Method</a>. Looking back on that post I unfortunately did a poor job describing the code. In this post, I&#39;ll go more into the code from that post, and define a more generalized method to solving the target hitting problem using direct shooting.</p> <h2 id=previous_example_target_hitting_with_automatic_differentiation ><a href="#previous_example_target_hitting_with_automatic_differentiation" class=header-anchor >Previous Example: Target Hitting with Automatic Differentiation</a></h2> <p><a href="https://michaszj.github.io/starcoffee/posts/the-direct-shooting-method/">In the previous post on the direct shooting method</a>, I covered how to solve the target hitting problem using the <a href="https://en.wikipedia.org/wiki/Newton&#37;27s_method#Systems_of_equations">multivariable Newton&#39;s Method</a>. Newton&#39;s Method involves calculating Jacobian matrices, which I did using automatic differentiation &#40;see <a href="https://michaszj.github.io/starcoffee/posts/the-direct-shooting-method/#mathematical_background">here</a> if you need a refresher on the math&#41;. I apologize for failing to mention this explicitly, as calculating the Jacobian matrix is an important step in this process.</p> <p>In that post, I used <code>Zygote.jl</code> as the automatic differentiation library, and calculated the Jacobian matrices using:</p> <pre><code class="julia hljs">F(u) = [
    (u[<span class=hljs-number >1</span>] * <span class=hljs-number >2</span>*u[<span class=hljs-number >2</span>]/g) - target[<span class=hljs-number >1</span>],
    <span class=hljs-number >0</span>
]

un = [ẋ₀, ẏ₀]

DF = jacobian(F, un)[<span class=hljs-number >1</span>]</code></pre> <p>Here, we are calculating the Jacobian using automatic differentiation, passing in the function that defines the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >F</mi></mrow><annotation encoding="application/x-tex">\mathbf F</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">F</span></span></span></span> matrix and the initial conditions. Here, <code>F&#40;&#41;</code> is a function of the initial <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> velocities of the projectile.</p> <h2 id=approximating_the_jacobian_matrix_with_finite_differences ><a href="#approximating_the_jacobian_matrix_with_finite_differences" class=header-anchor >Approximating the Jacobian Matrix with Finite Differences</a></h2> <p>Now let&#39;s go over approximating the numerical value of the Jacobian matrix. This is a more general method because we often only have the dynamics of a system, not the kinematics. When we only have the dynamics of a system, the previous method using automatic differentiation does not work.</p> <p>Just for reference, the Jacobian of the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >F</mi></mrow><annotation encoding="application/x-tex">\mathbf F</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">F</span></span></span></span> matrix is defined as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >J</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign="center center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mi>a</mi><mn>1</mn></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >…</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mi><mi mathvariant=normal >⋮</mi><mpadded height=0em  voffset=0em ><mspace mathbackground=black  width=0em  height=1.5em ></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >⋱</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mi><mi mathvariant=normal >⋮</mi><mpadded height=0em  voffset=0em ><mspace mathbackground=black  width=0em  height=1.5em ></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mi>m</mi></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mi>a</mi><mn>1</mn></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >…</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mi>m</mi></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{J} = \begin{bmatrix} \dfrac{ \partial F_{1} }{ \partial a_{1} } &amp; \dots &amp; \dfrac{ \partial F_{1} }{ \partial a_{n} } \\ \vdots &amp; \ddots &amp; \vdots \\ \dfrac{ \partial F_{m} }{ \partial a_{1} } &amp; \dots &amp; \dfrac{ \partial F_{m} }{ \partial a_{n} } \end{bmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">J</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:6.2749em;vertical-align:-2.8874em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.25em;"><span style="top:-2.311em;"><span class=pstrut  style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.458em;"><span class=pstrut  style="height:4.416em;"></span><span style="height:2.416em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='2.416em' style='width:0.6667em' viewBox='0 0 666.67 2416' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V2416 H319z M319 0 H403 V2416 H319z'/></svg></span></span><span style="top:-6.5111em;"><span class=pstrut  style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.75em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.3874em;"><span style="top:-5.7035em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3675em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ><span class=mord >⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-1.6361em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.8874em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.3874em;"><span style="top:-5.516em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ><span class=minner >…</span></span></span><span style="top:-3.18em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ><span class=minner >⋱</span></span></span><span style="top:-1.4486em;"><span class=pstrut  style="height:3.5em;"></span><span class=mord ><span class=minner >…</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.8874em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.3874em;"><span style="top:-5.7035em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3675em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ><span class=mord >⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-1.6361em;"><span class=pstrut  style="height:3.6875em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.8874em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.25em;"><span style="top:-2.311em;"><span class=pstrut  style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.458em;"><span class=pstrut  style="height:4.416em;"></span><span style="height:2.416em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='2.416em' style='width:0.6667em' viewBox='0 0 666.67 2416' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V2416 H263z M263 0 H347 V2416 H263z'/></svg></span></span><span style="top:-6.5111em;"><span class=pstrut  style="height:4.416em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.75em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Automatic differentiation gives us essentially the exact numerical value of the Jacobian matrix &#40;minus errors due to floating-point values&#41;. Without the kinematic equations, we can instead use finite differences to approximate the terms of the Jacobian:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mi>m</mi></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mi>a</mi><mi>n</mi></msub></mrow></mfrac><mo>≈</mo><mfrac><mrow><mi>F</mi><mo stretchy=false >(</mo><msub><mi>a</mi><mrow><mi>n</mi><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo stretchy=false >)</mo><mo>−</mo><mi>F</mi><mo stretchy=false >(</mo><msub><mi>a</mi><mrow><mi>n</mi><mo separator=true >,</mo><mn>1</mn></mrow></msub><mo stretchy=false >)</mo></mrow><mrow><msub><mi>a</mi><mrow><mi>n</mi><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>a</mi><mrow><mi>n</mi><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \frac{\partial F_m}{\partial a_n} \approx \frac{F(a_{n,2}) - F(a_{n,1})}{a_{n,2} - a_{n,1}} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.2074em;vertical-align:-0.836em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.3991em;vertical-align:-0.9721em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">a</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>For this problem, hitting a target with a projectile, the general <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >F</mi></mrow><annotation encoding="application/x-tex">\mathbf{F}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">F</span></span></span></span> matrix is defined as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >F</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi>x</mi><mo stretchy=false >(</mo><msub><mi>t</mi><mi>t</mi></msub><mo separator=true >;</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mn>0</mn></msub><mo stretchy=false >)</mo><mo>−</mo><msub><mi>x</mi><mi>t</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi>y</mi><mo stretchy=false >(</mo><msub><mi>t</mi><mi>f</mi></msub><mo separator=true >;</mo><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mn>0</mn></msub><mo stretchy=false >)</mo><mo>−</mo><msub><mi>y</mi><mi>t</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{F} = \begin{bmatrix} x(t_{t}; \dot{x}_{0}) - x_{t} \\ y(t_{f}; \dot{y}_{0}) - y_{t} \end{bmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">F</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.4em;vertical-align:-0.95em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span> <p>Due to the problem we are covering, we can simplify this to:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >F</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi>x</mi><mo stretchy=false >(</mo><msub><mi>t</mi><mi>t</mi></msub><mo separator=true >;</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mn>0</mn></msub><mo stretchy=false >)</mo><mo>−</mo><msub><mi>x</mi><mi>t</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{F} = \begin{bmatrix} x(t_{t}; \dot{x}_{0}) - x_{t} \\ 0 \end{bmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">F</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:2.4em;vertical-align:-0.95em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span> <p>We can do this since the final <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> value of the projectile is always zero, it always hits the ground eventually, and we are assuming the target is always on the ground as well. Now we can approximate the Jacobian of this matrix as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >J</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mn>0</mn></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mn>0</mn></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>≈</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow><mrow><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow><mrow><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{J} = \begin{bmatrix} \dfrac{\partial F_1}{\partial \dot x_0} &amp; \dfrac{\partial F_1}{\partial \dot y_0} \\ &amp; \\ 0 &amp; 0 \end{bmatrix} \approx \begin{bmatrix} \dfrac{F_{1,2} - F_{1,1}}{\dot x_{0,2} - \dot x_{0,1}} &amp; \dfrac{F_{1,2} - F_{1,1}}{\dot y_{0,2} - \dot y_{0,1}} \\ &amp; \\ 0 &amp; 0 \end{bmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">J</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:4.6519em;vertical-align:-2.0759em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.35em;"><span style="top:-1.95em;"><span class=pstrut  style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.097em;"><span class=pstrut  style="height:3.155em;"></span><span style="height:0.616em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.616em' style='width:0.6667em' viewBox='0 0 666.67 616' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V616 H319z M319 0 H403 V616 H319z'/></svg></span></span><span style="top:-4.35em;"><span class=pstrut  style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.85em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.5759em;"><span style="top:-4.5759em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.8555em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ></span></span><span style="top:-1.6555em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.0759em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.5759em;"><span style="top:-4.5759em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.8555em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ></span></span><span style="top:-1.6555em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.0759em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.35em;"><span style="top:-1.95em;"><span class=pstrut  style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.097em;"><span class=pstrut  style="height:3.155em;"></span><span style="height:0.616em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.616em' style='width:0.6667em' viewBox='0 0 666.67 616' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V616 H263z M263 0 H347 V616 H263z'/></svg></span></span><span style="top:-4.35em;"><span class=pstrut  style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.85em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:4.8001em;vertical-align:-2.15em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='1.216em' style='width:0.6667em' viewBox='0 0 666.67 1216' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V1216 H319z M319 0 H403 V1216 H319z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.6162em;"><span style="top:-4.6162em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.8041em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ></span></span><span style="top:-1.6041em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.1162em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.6162em;"><span style="top:-4.6162em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.8041em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ></span></span><span style="top:-1.6041em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.1162em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.65em;"><span style="top:-1.711em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.858em;"><span class=pstrut  style="height:3.216em;"></span><span style="height:1.216em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='1.216em' style='width:0.6667em' viewBox='0 0 666.67 1216' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V1216 H263z M263 0 H347 V1216 H263z'/></svg></span></span><span style="top:-4.7111em;"><span class=pstrut  style="height:3.216em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.15em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Where</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>x</mi><mo stretchy=false >(</mo><msub><mi>t</mi><mi>t</mi></msub><mo separator=true >;</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub><mo stretchy=false >)</mo><mo>−</mo><msub><mi>x</mi><mi>t</mi></msub><mspace width=1em /><mspace width=1em /><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>=</mo><mi>x</mi><mo stretchy=false >(</mo><msub><mi>t</mi><mi>t</mi></msub><mo separator=true >;</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo stretchy=false >)</mo><mo>−</mo><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex"> F_{1,1} = x(t_{t}; \dot{x}_{0,1}) - x_{t} \quad \quad F_{1,2} = x(t_{t}; \dot{x}_{0,2}) - x_{t} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.9694em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">x</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.9694em;vertical-align:-0.2861em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:1em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord mathnormal">x</span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">t</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span></span><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> <p>To demonstrate using this method, let&#39;s use a more complex version of the previous example. We&#39;ll still try to hit a target with a projectile, but now we&#39;ll also introduce air resistance. The dynamics of the projectile are now defined by the following differential equations:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.25em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mover accent=true ><mi>x</mi><mo>¨</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mo>−</mo><mfrac><mi>g</mi><msub><mi>v</mi><mi>t</mi></msub></mfrac><mover accent=true ><mi>x</mi><mo>˙</mo></mover></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mover accent=true ><mi>y</mi><mo>¨</mo></mover></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>=</mo><mo>−</mo><mi>g</mi><mo>−</mo><mfrac><mi>g</mi><msub><mi>v</mi><mi>t</mi></msub></mfrac><mover accent=true ><mi>y</mi><mo>˙</mo></mover></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> \begin{align*} \ddot x &amp;= - \frac{g}{v_t} \dot x \\ \ddot y &amp;= -g - \frac{g}{v_t} \dot y \end{align*} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:4.4871em;vertical-align:-1.9936em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.4936em;"><span style="top:-4.4936em;"><span class=pstrut  style="height:3.1076em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.2222em;"><span class=mord >¨</span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.1076em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1944em;"><span class=mord >¨</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.9936em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.4936em;"><span style="top:-4.4936em;"><span class=pstrut  style="height:3.1076em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord >−</span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1076em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class=pstrut  style="height:3.1076em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mord >−</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1076em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.9936em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the terminal velocity, defined as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mi>m</mi><mi>g</mi></mrow><mi>c</mi></mfrac></mrow><annotation encoding="application/x-tex"> v_t = \frac{mg}{c} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5806em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:1.7936em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.1076em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">c</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> <p>Where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> is the projectile mass and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span> is the drag coefficient. These differential equations do have an analytical solution, so we can still use the previous method to solve this problem. However, for demonstration of the general technique I won&#39;t cover that.</p> <p>Let&#39;s get into some code now. For modeling and numerically solving the system of differential equations we&#39;ll be using <code>ModelingToolkit.jl</code> and <code>OrdinaryDiffEq.jl</code>. Importing the required libraries:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> CairoMakie, AlgebraOfGraphics
<span class=hljs-keyword >using</span> ModelingToolkit, OrdinaryDiffEq, LinearAlgebra
set_aog_theme!()</code></pre> <p>Defining constants and system variables:</p> <pre><code class="julia hljs"><span class=hljs-keyword >const</span> g = <span class=hljs-number >9.80665</span>
<span class=hljs-keyword >const</span> m = <span class=hljs-number >5.0</span>
<span class=hljs-keyword >const</span> c = <span class=hljs-number >0.25</span>
<span class=hljs-keyword >const</span> vt = m*g / c

<span class=hljs-meta >@parameters</span> t
D = Differential(t)

<span class=hljs-meta >@variables</span> x(t) ẋ(t) y(t) ẏ(t)</code></pre> <p>Defining the <code>ODESystem</code>:</p> <pre><code class="julia hljs">sys = ODESystem(
    [
        D(x) ~ ẋ,
        D(ẋ) ~ -(g/vt)*ẋ,
        D(y) ~ ẏ,
        D(ẏ) ~ -g - (g/vt)*ẏ
    ],
    t,
    name = :proj_drag_system
)</code></pre> <p>When simulating this system, the simulation will run even when the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> value becomes negative, i.e., the projectile falls through and continues on below the ground. We obviously don&#39;t want this, so we&#39;ll create a callback to interrupt the simulation when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y=0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:0.6444em;"></span><span class=mord >0</span></span></span></span> &#40;see <a href="https://docs.sciml.ai/DiffEqDocs/stable/features/callback_functions/">Event Handling and Callback Functions</a> documentation for more information&#41;. The callback is defined with:</p> <pre><code class="julia hljs">ground_condition(u, t, integrator) = u[<span class=hljs-number >3</span>]
ground_affect!(integrator) = terminate!(integrator)
ground_cb = ContinuousCallback(ground_condition, ground_affect!)</code></pre> <p>The continuous callback works by triggering when the condition function is equal to zero, in this case the <code>ground_condition</code> function. I set the function equal to the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> value, thus it will trigger when <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> becomes zero. This causes the simulation to terminate, as at that point the projectile has impacted the ground.</p> <p>Now we need to set up our initial simulations. For this method, we need to start with two separate initial guesses.</p> <pre><code class="julia hljs">target = [<span class=hljs-number >200</span>, <span class=hljs-number >0</span>]

ẋ<span class=hljs-number >1</span> = <span class=hljs-number >40.0</span>
ẋ<span class=hljs-number >2</span> = <span class=hljs-number >41.0</span>

ẏ<span class=hljs-number >1</span> = <span class=hljs-number >25.0</span>
ẏ<span class=hljs-number >2</span> = <span class=hljs-number >26.0</span>

<span class=hljs-keyword >function</span> simulate_projectile(ẋ<span class=hljs-number >0</span>, ẏ<span class=hljs-number >0</span>; tspan=[<span class=hljs-number >0.0</span>, <span class=hljs-number >15.0</span>])
    u0 = [
        x =&gt; <span class=hljs-number >0.0</span>,
        ẋ =&gt; ẋ<span class=hljs-number >0</span>,
        y =&gt; <span class=hljs-number >0.0</span>,
        ẏ =&gt; ẏ<span class=hljs-number >0</span>
    ]

    prob = ODEProblem(sys, u0, tspan, jac=<span class=hljs-literal >true</span>)

    <span class=hljs-keyword >return</span> solve(prob, Tsit5(), callback=ground_cb)
<span class=hljs-keyword >end</span>

sol1 = simulate_projectile(ẋ<span class=hljs-number >1</span>, ẏ<span class=hljs-number >1</span>)
sol2 = simulate_projectile(ẋ<span class=hljs-number >2</span>, ẏ<span class=hljs-number >2</span>)

<span class=hljs-keyword >function</span> interp_sol(
    solution::ODESolution,
    vars::<span class=hljs-built_in >Vector</span>{Num},
    times::<span class=hljs-built_in >Union</span>{<span class=hljs-built_in >StepRangeLen</span>, <span class=hljs-built_in >Vector</span>}
)

    sol_interp = solution(times)
    <span class=hljs-keyword >return</span> [sol_interp[var] <span class=hljs-keyword >for</span> var <span class=hljs-keyword >in</span> vars]
<span class=hljs-keyword >end</span>

fig1 = Figure(resolution=(<span class=hljs-number >1000</span>,<span class=hljs-number >300</span>))
ax1 = Axis(fig1[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>], xlabel=<span class=hljs-string >&quot;x (m)&quot;</span>, ylabel=<span class=hljs-string >&quot;y (m)&quot;</span>, aspect = DataAspect())

scatter!(ax1, [target[<span class=hljs-number >1</span>]], [target[<span class=hljs-number >2</span>]], label=<span class=hljs-string >&quot;Target&quot;</span>)

times=<span class=hljs-number >0.0</span>:<span class=hljs-number >0.1</span>:<span class=hljs-number >15.0</span>
lines!(ax1, interp_sol(sol1, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 1&quot;</span>)
lines!(ax1, interp_sol(sol2, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 2&quot;</span>)

axislegend(ax1, position=:lt)</code></pre> <div class=im-100 ><img src="/starcoffee/assets/posts/direct-shooting-with-approx/code/init.svg" alt=""></div> <p>With the initial guesses defined, we can now calculate the next guess by using Newton&#39;s Method, and approximating the terms of the Jacobian using finite differences:</p> <pre><code class="julia hljs">F1 = [sol1[x, <span class=hljs-keyword >end</span>], sol1[y, <span class=hljs-keyword >end</span>]] .- target
F2 = [sol2[x, <span class=hljs-keyword >end</span>], sol2[y, <span class=hljs-keyword >end</span>]] .- target

dF = [
    (F2[<span class=hljs-number >1</span>] - F1[<span class=hljs-number >1</span>])/(ẋ<span class=hljs-number >2</span> - ẋ<span class=hljs-number >1</span>) (F2[<span class=hljs-number >1</span>] - F1[<span class=hljs-number >1</span>])/(ẏ<span class=hljs-number >2</span> - ẏ<span class=hljs-number >1</span>)
    <span class=hljs-number >0</span> <span class=hljs-number >0</span>
]

ẋ<span class=hljs-number >3_</span>sim, ẏ<span class=hljs-number >3_</span>sim = [ẋ<span class=hljs-number >2</span>, ẏ<span class=hljs-number >2</span>] .- pinv(dF)*F2</code></pre> <pre><code class="plaintext hljs">2-element Vector{Float64}:
 41.76455763846823
 26.764557638468233</code></pre> <p>These two values are our next guesses for the required initial velocity of the projectile. These values should provide a more accurate result. However, we&#39;ll probably still need to iterate multiple times to get to a decently accurate result. Also note the use of <code>pinv&#40;&#41;</code> instead of the <code>inv&#40;&#41;</code> function. An error occurs when calculating the inverse of the <code>dF</code> matrix, I think the inverse is technically undefined for it. In any case, calculating the pseudoinverse works just fine.</p> <p>Now we can set up the loop to repeat the process above to continuously change the initial velocities to hit the target:</p> <pre><code class="julia hljs">fig2 = Figure(resolution=(<span class=hljs-number >1000</span>,<span class=hljs-number >300</span>))
    ax2 = Axis(fig2[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>], xlabel=<span class=hljs-string >&quot;x (m)&quot;</span>, ylabel=<span class=hljs-string >&quot;y (m)&quot;</span>, aspect = DataAspect())

    scatter!(ax2, [target[<span class=hljs-number >1</span>]], [target[<span class=hljs-number >2</span>]], label=<span class=hljs-string >&quot;Target&quot;</span>)

    lines!(ax2, interp_sol(sol1, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 1&quot;</span>)
    lines!(ax2, interp_sol(sol2, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 2&quot;</span>)

    errors = [
    abs(sol1[x, <span class=hljs-keyword >end</span>] - target[<span class=hljs-number >1</span>]),
    abs(sol2[x, <span class=hljs-keyword >end</span>] - target[<span class=hljs-number >1</span>])
]

ẋ<span class=hljs-number >2_</span>sim = copy(ẋ<span class=hljs-number >2</span>)
ẏ<span class=hljs-number >2_</span>sim = copy(ẏ<span class=hljs-number >2</span>)

n_iters = <span class=hljs-number >10</span>

<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:n_iters
    sol3 = simulate_projectile(ẋ<span class=hljs-number >3_</span>sim, ẏ<span class=hljs-number >3_</span>sim)

    <span class=hljs-keyword >global</span> F1 = copy(F2)
    <span class=hljs-keyword >global</span> F2 = [sol3[x, <span class=hljs-keyword >end</span>], sol3[y, <span class=hljs-keyword >end</span>]] .- target

    <span class=hljs-keyword >global</span> dF = [
        (F2[<span class=hljs-number >1</span>] - F1[<span class=hljs-number >1</span>])/(ẋ<span class=hljs-number >3_</span>sim - ẋ<span class=hljs-number >2_</span>sim) (F2[<span class=hljs-number >1</span>] - F1[<span class=hljs-number >1</span>])/(ẏ<span class=hljs-number >3_</span>sim - ẏ<span class=hljs-number >2_</span>sim)
        <span class=hljs-number >0</span> <span class=hljs-number >0</span>
    ]

    <span class=hljs-keyword >global</span> ẋ<span class=hljs-number >2_</span>sim = copy(ẋ<span class=hljs-number >3_</span>sim)
    <span class=hljs-keyword >global</span> ẏ<span class=hljs-number >2_</span>sim = copy(ẏ<span class=hljs-number >3_</span>sim)

    u̇ = [ẋ<span class=hljs-number >2_</span>sim, ẏ<span class=hljs-number >2_</span>sim] .- pinv(dF)*F2

    <span class=hljs-keyword >global</span> ẋ<span class=hljs-number >3_</span>sim = u̇[<span class=hljs-number >1</span>]
    <span class=hljs-keyword >global</span> ẏ<span class=hljs-number >3_</span>sim = u̇[<span class=hljs-number >2</span>]

    <span class=hljs-keyword >if</span> i &lt; n_iters
        lines!(
            ax2, interp_sol(sol3, [x,y], times)...,
            linestyle=:dash, color = (:red, <span class=hljs-number >0.2</span>)
        )
    <span class=hljs-keyword >else</span>
        lines!(
            ax2, interp_sol(sol3, [x,y], times)...,
            color=:red, label=<span class=hljs-string >&quot;Trajectory <span class=hljs-subst >$(n_iters+<span class=hljs-number >2</span>)</span>&quot;</span>
        )
    <span class=hljs-keyword >end</span>

    push!(errors, abs(sol3[x, <span class=hljs-keyword >end</span>] - target[<span class=hljs-number >1</span>]))
<span class=hljs-keyword >end</span>

axislegend(ax2, position=:lt)
fig2</code></pre> <div class=im-100 ><img src="/starcoffee/assets/posts/direct-shooting-with-approx/code/results.svg" alt=""></div> <pre><code class="julia hljs">fig3=Figure()

ax3=Axis(
    fig3[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>],
    xlabel=<span class=hljs-string >&quot;Iteration&quot;</span>, ylabel=<span class=hljs-string >&quot;Error&quot;</span>,
    yscale=log10, yminorticksvisible = <span class=hljs-literal >true</span>,
    yminorgridvisible = <span class=hljs-literal >true</span>, yminorticks = IntervalsBetween(<span class=hljs-number >9</span>),
    xticks=<span class=hljs-number >1</span>:<span class=hljs-number >2</span>:n_iters+<span class=hljs-number >2</span>
)

lines!(ax3, errors)

fig3</code></pre> <div class=im-75 ><img src="/starcoffee/assets/posts/direct-shooting-with-approx/code/errors.svg" alt=""></div> <p>As can be seen, through multiple iterations, we successfully get closer and closer to hitting the target by using the direct shooting method with approximate Jacobian matrix values.</p> <h2 id=hitting_a_target_in_mid-air ><a href="#hitting_a_target_in_mid-air" class=header-anchor >Hitting a Target in Mid-Air</a></h2> <p>Now for a slightly more complicated example. Up until now, we have been assuming the target is on the ground. Let&#39;s now consider the case where a target is in an arbitrary position.</p> <p>First we need to redefine the Jacobian matrix, as it was defined with the assumption that the final <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> value of the projectile is always zero. For the arbitrary case, the Jacobian can be approximated as:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >J</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mn>0</mn></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mn>0</mn></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>2</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mn>0</mn></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><mi mathvariant=normal >∂</mi><msub><mi>F</mi><mn>2</mn></msub></mrow><mrow><mi mathvariant=normal >∂</mi><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mn>0</mn></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>≈</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.16em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow><mrow><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>F</mi><mrow><mn>1</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow><mrow><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>F</mi><mrow><mn>2</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>F</mi><mrow><mn>2</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow><mrow><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mover accent=true ><mi>x</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mstyle></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mstyle displaystyle=true  scriptlevel=0 ><mfrac><mrow><msub><mi>F</mi><mrow><mn>2</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mi>F</mi><mrow><mn>2</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow><mrow><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>2</mn></mrow></msub><mo>−</mo><msub><mover accent=true ><mi>y</mi><mo>˙</mo></mover><mrow><mn>0</mn><mo separator=true >,</mo><mn>1</mn></mrow></msub></mrow></mfrac></mstyle></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbf{J} = \begin{bmatrix} \dfrac{\partial F_1}{\partial \dot x_0} &amp; \dfrac{\partial F_1}{\partial \dot y_0} \\ &amp; \\ \dfrac{\partial F_2}{\partial \dot x_0} &amp; \dfrac{\partial F_2}{\partial \dot y_0} \end{bmatrix} \approx \begin{bmatrix} \dfrac{F_{1,2} - F_{1,1}}{\dot x_{0,2} - \dot x_{0,1}} &amp; \dfrac{F_{1,2} - F_{1,1}}{\dot y_{0,2} - \dot y_{0,1}} \\ &amp; \\ \dfrac{F_{2,2} - F_{2,1}}{\dot x_{0,2} - \dot x_{0,1}} &amp; \dfrac{F_{2,2} - F_{2,1}}{\dot y_{0,2} - \dot y_{0,1}} \end{bmatrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">J</span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:5.7038em;vertical-align:-2.6019em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.95em;"><span style="top:-2.011em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.158em;"><span class=pstrut  style="height:3.816em;"></span><span style="height:1.816em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='1.816em' style='width:0.6667em' viewBox='0 0 666.67 1816' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V1816 H319z M319 0 H403 V1816 H319z'/></svg></span></span><span style="top:-5.6111em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.45em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.1019em;"><span style="top:-5.1019em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3814em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ></span></span><span style="top:-1.65em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.6019em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.1019em;"><span style="top:-5.1019em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3814em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ></span></span><span style="top:-1.65em;"><span class=pstrut  style="height:3.3714em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3714em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.6019em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.95em;"><span style="top:-2.011em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.158em;"><span class=pstrut  style="height:3.816em;"></span><span style="height:1.816em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='1.816em' style='width:0.6667em' viewBox='0 0 666.67 1816' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V1816 H263z M263 0 H347 V1816 H263z'/></svg></span></span><span style="top:-5.6111em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.45em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2778em;"></span></span><span class=base ><span class=strut  style="height:5.8649em;vertical-align:-2.6824em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.95em;"><span style="top:-2.011em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.158em;"><span class=pstrut  style="height:3.816em;"></span><span style="height:1.816em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='1.816em' style='width:0.6667em' viewBox='0 0 666.67 1816' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V1816 H319z M319 0 H403 V1816 H319z'/></svg></span></span><span style="top:-5.6111em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.45em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.1824em;"><span style="top:-5.1824em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3703em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ></span></span><span style="top:-1.65em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord accent"><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal">x</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.1111em;"><span class=mord >˙</span></span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.6824em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.1824em;"><span style="top:-5.1824em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.3703em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ></span></span><span style="top:-1.65em;"><span class=pstrut  style="height:3.3603em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.3603em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord accent"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.6679em;"><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span class=accent-body  style="left:-0.0833em;"><span class=mord >˙</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.1944em;"><span></span></span></span></span></span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.6824em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.95em;"><span style="top:-2.011em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.158em;"><span class=pstrut  style="height:3.816em;"></span><span style="height:1.816em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='1.816em' style='width:0.6667em' viewBox='0 0 666.67 1816' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V1816 H263z M263 0 H347 V1816 H263z'/></svg></span></span><span style="top:-5.6111em;"><span class=pstrut  style="height:3.816em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.45em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>In practice, this situation is not much more complicated, we just need to ensure we are changing the definition of the Jacobian properly, the rest of our code written previously will work perfectly fine. Another change we should make is to the callback function. For this case, I not only want the simulation to stop when the projectile hits the ground, but also if the projectile reaches the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> position of the target. We can define the new callback as:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> terminate_conditions(out, u, t, integrator)
    out[<span class=hljs-number >1</span>] = u[<span class=hljs-number >3</span>]              <span class=hljs-comment ># projectile hits ground</span>
    out[<span class=hljs-number >2</span>] = target2[<span class=hljs-number >1</span>] - u[<span class=hljs-number >1</span>] <span class=hljs-comment ># projectile should&#x27;ve hit target</span>
<span class=hljs-keyword >end</span>

terminate_affect!(integrator, idx) = terminate!(integrator)

terminate_callback = VectorContinuousCallback(
    terminate_conditions, terminate_affect!, <span class=hljs-number >2</span>
)

<span class=hljs-keyword >function</span> simulate_projectile2(ẋ<span class=hljs-number >0</span>, ẏ<span class=hljs-number >0</span>; tspan=[<span class=hljs-number >0.0</span>, <span class=hljs-number >15.0</span>])
    u0 = [
        x =&gt; <span class=hljs-number >0.0</span>,
        ẋ =&gt; ẋ<span class=hljs-number >0</span>,
        y =&gt; <span class=hljs-number >0.0</span>,
        ẏ =&gt; ẏ<span class=hljs-number >0</span>
    ]

    prob = ODEProblem(sys, u0, tspan, jac=<span class=hljs-literal >true</span>)

    <span class=hljs-keyword >return</span> solve(prob, Tsit5(), callback=terminate_callback)
<span class=hljs-keyword >end</span></code></pre> <p>The same logic applies when using <code>VectorContinuousCallback</code> as with <code>ContinuousCallback</code>, we define the conditions so that the callback is triggered when the condition function is equal to zero. In this case, we just have to define multiple conditions.</p> <p>Let&#39;s choose a new target position at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mn>180</mn><mo separator=true >,</mo><mn>20</mn><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(180,20)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord >180</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.1667em;"></span><span class=mord >20</span><span class=mclose >)</span></span></span></span>. We can use the previous two guesses to calculate the initial conditions for this case as well.</p> <pre><code class="julia hljs">target2 = [<span class=hljs-number >180</span>, <span class=hljs-number >20</span>]

sol12 = simulate_projectile2(ẋ<span class=hljs-number >1</span>, ẏ<span class=hljs-number >1</span>)
sol22 = simulate_projectile2(ẋ<span class=hljs-number >2</span>, ẏ<span class=hljs-number >2</span>)

fig4 = Figure(resolution=(<span class=hljs-number >1000</span>,<span class=hljs-number >300</span>))
ax4 = Axis(fig4[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>], xlabel=<span class=hljs-string >&quot;x (m)&quot;</span>, ylabel=<span class=hljs-string >&quot;y (m)&quot;</span>, aspect = DataAspect())

scatter!(ax4, [target2[<span class=hljs-number >1</span>]], [target2[<span class=hljs-number >2</span>]], label=<span class=hljs-string >&quot;Target&quot;</span>)

lines!(ax4, interp_sol(sol12, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 1&quot;</span>)
lines!(ax4, interp_sol(sol22, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 2&quot;</span>)

axislegend(ax4, position=:lt)</code></pre> <div class=im-100 ><img src="/starcoffee/assets/posts/direct-shooting-with-approx/code/guess2.svg" alt=""></div> <p>Once again, we define the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >F</mi></mrow><annotation encoding="application/x-tex">\mathbf F</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.6861em;"></span><span class="mord mathbf">F</span></span></span></span> matrices and the approximated Jacobian:</p> <pre><code class="julia hljs">F12 = [sol12[x, <span class=hljs-keyword >end</span>], sol12[y, <span class=hljs-keyword >end</span>]] .- target2
F22 = [sol22[x, <span class=hljs-keyword >end</span>], sol22[y, <span class=hljs-keyword >end</span>]] .- target2

dF2 = [
    (F22[<span class=hljs-number >1</span>] - F12[<span class=hljs-number >1</span>])/(ẋ<span class=hljs-number >2</span> - ẋ<span class=hljs-number >1</span>) (F22[<span class=hljs-number >1</span>] - F12[<span class=hljs-number >1</span>])/(ẏ<span class=hljs-number >2</span> - ẏ<span class=hljs-number >1</span>)
    (F22[<span class=hljs-number >2</span>] - F12[<span class=hljs-number >2</span>])/(ẋ<span class=hljs-number >2</span> - ẋ<span class=hljs-number >1</span>) (F22[<span class=hljs-number >2</span>] - F12[<span class=hljs-number >2</span>])/(ẏ<span class=hljs-number >2</span> - ẏ<span class=hljs-number >1</span>)
]

ẋ<span class=hljs-number >3_</span>sim2, ẏ<span class=hljs-number >3_</span>sim2 = [ẋ<span class=hljs-number >2</span>, ẏ<span class=hljs-number >2</span>] .- pinv(dF2)*F22</code></pre> <pre><code class="plaintext hljs">2-element Vector{Float64}:
 41.54055444454208
 26.540554444542085</code></pre> <p>As can be seen, we just need to include the extra terms for the <code>dF</code> variable to make it compatible for this case. Let&#39;s now do the iteration loop:</p> <pre><code class="julia hljs">fig5 = Figure(resolution=(<span class=hljs-number >1000</span>,<span class=hljs-number >300</span>))
ax5 = Axis(fig5[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>], xlabel=<span class=hljs-string >&quot;x (m)&quot;</span>, ylabel=<span class=hljs-string >&quot;y (m)&quot;</span>, aspect = DataAspect())

scatter!(ax5, [target2[<span class=hljs-number >1</span>]], [target2[<span class=hljs-number >2</span>]], label=<span class=hljs-string >&quot;Target&quot;</span>)

lines!(ax5, interp_sol(sol12, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 1&quot;</span>)
lines!(ax5, interp_sol(sol22, [x,y], times)..., label=<span class=hljs-string >&quot;Trajectory 2&quot;</span>)

ẋ<span class=hljs-number >2_</span>sim2 = copy(ẋ<span class=hljs-number >2</span>)
ẏ<span class=hljs-number >2_</span>sim2 = copy(ẏ<span class=hljs-number >2</span>)

errors2 = [
    sqrt((sol12[x, <span class=hljs-keyword >end</span>] - target2[<span class=hljs-number >1</span>])^<span class=hljs-number >2</span> + (sol12[y, <span class=hljs-keyword >end</span>] - target2[<span class=hljs-number >2</span>])^<span class=hljs-number >2</span>),
    sqrt((sol22[x, <span class=hljs-keyword >end</span>] - target2[<span class=hljs-number >1</span>])^<span class=hljs-number >2</span> + (sol22[y, <span class=hljs-keyword >end</span>] - target2[<span class=hljs-number >2</span>])^<span class=hljs-number >2</span>)
]

n_iters2 = <span class=hljs-number >10</span>

<span class=hljs-keyword >for</span> i <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:n_iters2
    sol32 = simulate_projectile2(ẋ<span class=hljs-number >3_</span>sim2, ẏ<span class=hljs-number >3_</span>sim2)

    <span class=hljs-keyword >global</span> F12 = copy(F22)
    <span class=hljs-keyword >global</span> F22 = [sol32[x, <span class=hljs-keyword >end</span>], sol32[y, <span class=hljs-keyword >end</span>]] .- target2

    <span class=hljs-keyword >global</span> dF2 = [
        (F22[<span class=hljs-number >1</span>] - F12[<span class=hljs-number >1</span>])/(ẋ<span class=hljs-number >3_</span>sim2 - ẋ<span class=hljs-number >2_</span>sim2) (F22[<span class=hljs-number >1</span>] - F12[<span class=hljs-number >1</span>])/(ẏ<span class=hljs-number >3_</span>sim2 - ẏ<span class=hljs-number >2_</span>sim2)
        (F22[<span class=hljs-number >2</span>] - F12[<span class=hljs-number >2</span>])/(ẋ<span class=hljs-number >3_</span>sim2 - ẋ<span class=hljs-number >2_</span>sim2) (F22[<span class=hljs-number >2</span>] - F12[<span class=hljs-number >2</span>])/(ẏ<span class=hljs-number >3_</span>sim2 - ẏ<span class=hljs-number >2_</span>sim2)
    ]

    <span class=hljs-keyword >global</span> ẋ<span class=hljs-number >2_</span>sim2 = copy(ẋ<span class=hljs-number >3_</span>sim2)
    <span class=hljs-keyword >global</span> ẏ<span class=hljs-number >2_</span>sim2 = copy(ẏ<span class=hljs-number >3_</span>sim2)

    u̇ = [ẋ<span class=hljs-number >2_</span>sim2, ẏ<span class=hljs-number >2_</span>sim2] .- pinv(dF2)*F22

    <span class=hljs-keyword >global</span> ẋ<span class=hljs-number >3_</span>sim2 = u̇[<span class=hljs-number >1</span>]
    <span class=hljs-keyword >global</span> ẏ<span class=hljs-number >3_</span>sim2 = u̇[<span class=hljs-number >2</span>]

    <span class=hljs-keyword >if</span> i &lt; n_iters
        lines!(
            ax5, interp_sol(sol32, [x,y], times)...,
            linestyle=:dash, color = (:red, <span class=hljs-number >0.2</span>)
        )
    <span class=hljs-keyword >else</span>
        lines!(
            ax5, interp_sol(sol32, [x,y], times)...,
            color=:red, label=<span class=hljs-string >&quot;Trajectory <span class=hljs-subst >$(n_iters+<span class=hljs-number >2</span>)</span>&quot;</span>
        )
    <span class=hljs-keyword >end</span>
    push!(errors2, sqrt((sol32[x, <span class=hljs-keyword >end</span>] - target2[<span class=hljs-number >1</span>])^<span class=hljs-number >2</span> + (sol32[y, <span class=hljs-keyword >end</span>] - target2[<span class=hljs-number >2</span>])^<span class=hljs-number >2</span>))
<span class=hljs-keyword >end</span>

axislegend(ax5, position=:lt)
fig5</code></pre> <div class=im-100 ><img src="/starcoffee/assets/posts/direct-shooting-with-approx/code/loop2.svg" alt=""></div> <pre><code class="julia hljs">fig6=Figure()

ax6=Axis(
    fig6[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>],
    xlabel=<span class=hljs-string >&quot;Iteration&quot;</span>, ylabel=<span class=hljs-string >&quot;Error&quot;</span>,
    yscale=log10, yminorticksvisible = <span class=hljs-literal >true</span>,
    yminorgridvisible = <span class=hljs-literal >true</span>, yminorticks = IntervalsBetween(<span class=hljs-number >9</span>),
    xticks=<span class=hljs-number >1</span>:<span class=hljs-number >2</span>:n_iters+<span class=hljs-number >2</span>
)

lines!(ax6, errors2)

fig6</code></pre> <div class=im-75 ><img src="/starcoffee/assets/posts/direct-shooting-with-approx/code/errors2.svg" alt=""></div> <p>As can be seen, by using a different callback function and changing the definition of the Jacobian matrix, we implemented a more generalized direct shooting method to solve the target hitting problem.</p> <h2 id=conclusion ><a href="#conclusion" class=header-anchor >Conclusion</a></h2> <p>Thanks for reading&#33; I Hope I clarified things a bit as the previous post on this topic was quite rough. I want to continue learning and writing about optimal control more, so expect more posts on this topic soon. I am taking a bit of a break from working on <a href="https://michaszj.github.io/starcoffee/posts/satellite-analysis-toolkit/">SAT</a>, I want to explore some other topics. So hopefully soon there should be an interesting variety of work going up on Star Coffee. Until next time.</p> <div class=page-foot > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> <a href="https://michaszj.github.io/">Michal Jagodzinski</a>. Last modified: August 22, 2023. <br>Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> <script src="/starcoffee/libs/highlight/highlight.min.js"></script> <script>hljs.highlightAll();hljs.configure({tabReplace: ' '});</script> <label for=sidebar-checkbox  class=sidebar-toggle ></label>